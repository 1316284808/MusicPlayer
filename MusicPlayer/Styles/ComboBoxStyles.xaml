<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                    xmlns:converters="clr-namespace:MusicPlayer.Converters"
                    xmlns:controls="clr-namespace:MusicPlayer.Helper"  >

    <!-- 排序规则到图标符号的转换器 -->
    <converters:SortRuleToSymbolConverter x:Key="SortRuleToSymbolConverter"/>

    <!-- WPF UI 风格的 ComboBox 样式 - 针对窄宽度显示图标 -->
    <Style x:Key="WpfUiComboBoxStyle" TargetType="ComboBox">
        <!-- 使用 WPF UI 的默认控件背景色 -->
        <Setter Property="Background" Value="{DynamicResource BackgroundBrush}" />
        <Setter Property="Foreground" Value="{DynamicResource TextBrush}" />
        <Setter Property="BorderBrush" Value="{DynamicResource TextBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="FontSize" Value="{DynamicResource ControlContentThemeFontSize}" />
        <Setter Property="FontFamily" Value="{DynamicResource ContentControlThemeFontFamily}" />
        
        <!-- 修改模板以支持圆角和 Fluent 外观，并优化显示逻辑 -->
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ComboBox">
                    <Grid x:Name="MainGrid" SnapsToDevicePixels="True" Width="40" Height="35">
                        <Popup x:Name="PART_Popup"
                               AllowsTransparency="True"
                               IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                               Placement="Bottom"
                               PopupAnimation="{DynamicResource {x:Static SystemParameters.ComboBoxPopupAnimationKey}}">
                            <Border x:Name="DropDownBorder"
                                    Background="{DynamicResource BackgroundBrush}"
                                    BorderBrush="{DynamicResource TextBrush}"
                                    BorderThickness="0.1"
                                    CornerRadius="8"
                                    MinWidth="{Binding ActualWidth, ElementName=MainGrid}"
                                    MaxHeight="{TemplateBinding MaxDropDownHeight}">
                                <ScrollViewer x:Name="DropDownScrollViewer"
                                              Foreground="{TemplateBinding Foreground}">
                                    <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained" />
                                </ScrollViewer>
                            </Border>
                        </Popup>

                        <ToggleButton x:Name="ToggleButton"
                                      Background="{TemplateBinding Background}"
                                      BorderBrush="{TemplateBinding BorderBrush}"
                                      BorderThickness="{TemplateBinding BorderThickness}"
                                      IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                         Width="40" Height="35"
                                      Padding="0"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center">
                            <!-- 动态显示排序图标 -->
                            <controls:CustomIcon IconSize="18"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Kind="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource SortRuleToSymbolConverter}}"/>
                        </ToggleButton>
                    </Grid>

                    <!-- 触发器 -->
                    <ControlTemplate.Triggers>
                        <!--<Trigger SourceName="ToggleButton" Property="IsMouseOver" Value="True">
                            <Setter TargetName="ToggleButton" Property="Background" Value="{DynamicResource BackgroundBrush}" />
                        </Trigger>
                        <Trigger SourceName="ToggleButton" Property="IsPressed" Value="True">
                            <Setter TargetName="ToggleButton" Property="Background" Value="{DynamicResource BackgroundBrush}" />
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="{DynamicResource TextFillColorDisabledBrush}" />
                            <Setter TargetName="ToggleButton" Property="Background" Value="{DynamicResource BackgroundBrush}" />
                        </Trigger>-->

                        <!-- 当下拉框打开时，显示完整的选项文本 -->
                        <Trigger Property="IsDropDownOpen" Value="True">
                            <Setter TargetName="DropDownScrollViewer" Property="CanContentScroll" Value="True" />
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- ComboBox ItemTemplate - 下拉选项只显示文本 -->
    <DataTemplate x:Key="SortOptionItemTemplate">
       <ui:TextBlock Text="{Binding Display}" 
                   VerticalAlignment="Center"
                   FontSize="12"
                   Foreground="{DynamicResource TextBrush}"
                    />
    </DataTemplate>

</ResourceDictionary>