<Application x:Class="MusicPlayer.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:MusicPlayer"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:MusicPlayer.Converters"
             xmlns:tb="http://www.hardcodet.net/taskbar"
              xmlns:Helper="clr-namespace:MusicPlayer.Helper"
             DispatcherUnhandledException="App_DispatcherUnhandledException"
           
            >
    <Application.Resources>
        <ResourceDictionary>
          
            <ResourceDictionary.MergedDictionaries>
                <ui:ThemesDictionary Theme="Light" />
                <ui:ControlsDictionary />
                <ResourceDictionary Source="Styles/MainStyles.xaml" />
                <ResourceDictionary Source="Styles/ComboBoxStyles.xaml" /> 
            </ResourceDictionary.MergedDictionaries>
            
            <!-- 应用资源转换器 - 这些转换器用于处理特定的UI绑定逻辑 -->
            <!-- 布尔值转可见性转换器 -->
            <BooleanToVisibilityConverter x:Key="BoolToVis"/>
            
            <!-- 频谱高度转换器：将音频频谱数据转换为可视化高度 -->
            <converters:SpectrumHeightConverter x:Key="SpectrumHeightConverter"/>
            <!-- 模糊效果转换器：根据专辑封面存在与否调整背景模糊效果 -->
            <converters:BlurEffectConverter x:Key="BlurEffectConverter"/>
            
            <!-- 非空转布尔值转换器：处理对象存在性检查 -->
            <converters:NotNullToBooleanConverter x:Key="NotNullToBooleanConverter"/>
            
            <!-- 自定义布尔值转可见性转换器 -->
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            
            <!-- 枚举值到描述文本转换器 -->
            <converters:EnumToDescriptionConverter x:Key="EnumToDescriptionConverter"/>
            
            <!-- 系统托盘菜单资源 -->
            <ContextMenu x:Key="SysTrayMenu">
                <MenuItem   Command="{Binding ShowMainWindowCommand}" >
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Helper:CustomIcon Kind="BackHome" FontWeight="Normal"/>
                            <Separator Margin="2"/>
                            <ui:TextBlock Text="显示主窗口" FontWeight="SemiBold"/>
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>
                
                <Separator /> 
                <MenuItem   Command="{Binding PreviousTrackCommand}" >
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <Helper:CustomIcon Kind="Previous"  FontWeight="Normal"/>
                            <Separator Margin="2"/>
                            <ui:TextBlock Text="上一曲" FontWeight="SemiBold"/>
                        </StackPanel>
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem  Command="{Binding TogglePlayPauseCommand}" >
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                            <Helper:CustomIcon Kind="Play"  FontWeight="Normal"/>
                                <Separator Margin="2"/>
                                <ui:TextBlock Text="播放/暂停" FontWeight="SemiBold"/>
                            </StackPanel>
                        </MenuItem.Header>
                </MenuItem>
                <MenuItem  Command="{Binding NextTrackCommand}" >
                            <MenuItem.Header>
                                <StackPanel Orientation="Horizontal">
                            <Helper:CustomIcon Kind="Next"  FontWeight="Normal"/>
                                    <Separator Margin="2"/>
                                    <ui:TextBlock Text="下一曲" FontWeight="SemiBold"/>
                                </StackPanel>
                            </MenuItem.Header>
                </MenuItem>
                <Separator />
                            
                <MenuItem  Command="{Binding ExitApplicationCommand}" >
                                <MenuItem.Header>
                                    <StackPanel Orientation="Horizontal">
                            <Helper:CustomIcon Kind="Close"  FontWeight="Normal" Foreground="Red"/>
                                        <Separator Margin="2"/>
                            <ui:TextBlock Text="退出" FontWeight="SemiBold" Foreground="Red"/>
                                    </StackPanel>
                                </MenuItem.Header>
                </MenuItem>
            </ContextMenu>
            
            <!-- 系统托盘图标 -->
            <tb:TaskbarIcon x:Key="NotifyIcon"
                            IconSource="pack://application:,,,/MusicPlayer;component/resources/MusicPlayer.ico"
                            ToolTipText="音乐播放器"
                            LeftClickCommand="{Binding ShowMainWindowCommand}"
                            TrayLeftMouseDown="TaskbarIcon_LeftClick"
                            ContextMenu="{StaticResource SysTrayMenu}" />
        </ResourceDictionary>
    </Application.Resources>
</Application>