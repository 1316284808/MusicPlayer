<UserControl x:Class="MusicPlayer.Controls.TitleBarControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:MusicPlayer.ViewModels"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:controls="clr-namespace:MusicPlayer.Helper"
             mc:Ignorable="d"
             Background="Transparent" >
    <Border>
        <Border.Effect>
            <DropShadowEffect ShadowDepth="1" BlurRadius="8" Color="Black" Opacity="0.2"/>
        </Border.Effect>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="auto"/>
                <!-- 左侧：标题拖拽区域 -->
                <ColumnDefinition Width="*"/>
                <!-- 右侧：窗口控制按钮 -->
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" >
                <ui:Button x:Name="BackButton"   Background="Transparent"   HorizontalAlignment="Left"    Width="auto"
                   Cursor="Hand" ToolTip="返回上一页" Padding="0"    Command="{Binding GoBackCommand}">
                    <StackPanel   Orientation="Horizontal"  HorizontalAlignment="Left"  >
                        <controls:CustomIcon HorizontalAlignment="Left"   Kind="Back" Margin="5,2" />
                        <Separator Margin="2" />
                        <TextBlock Text="{Binding Title}" VerticalAlignment="Center"  Margin="5,2" FontSize="14" FontWeight="SemiBold" />

                    </StackPanel>
                </ui:Button>
            </StackPanel>

            <!-- 标题区域（可拖拽窗口） -->
            <Grid Grid.Column="1" Background="Transparent" x:Name="DragArea"
              MouseDown="DragArea_MouseDown" MouseMove="DragArea_MouseMove"
              MouseLeftButtonDown="DragArea_MouseLeftButtonDown">
            </Grid>

            <!-- 窗口控制按钮组 -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                <!-- 最小化按钮 -->
                <ui:Button  Margin="5,0,0,0" Command="{Binding MinimizeWindowCommand}" ToolTip="最小化" Background="Transparent">
                    <controls:CustomIcon Kind="Minimize"  IconSize="12"      />
                </ui:Button>
                <!-- 最大化/还原按钮 - 根据窗口状态显示不同图标 -->
                <ui:Button   Margin="5,0,0,0"  Command="{Binding MaximizeOrRestoreCommand}" ToolTip="最大化/还原">

                    <controls:CustomIcon  IconSize="12" >
                        <controls:CustomIcon.Style>
                            <Style TargetType="controls:CustomIcon" BasedOn="{StaticResource {x:Type controls:CustomIcon}}">
                                <!-- 默认显示播放图标 -->
                                <Setter Property="Kind" Value="Maximize"/>
                                <Style.Triggers>
                                    <!-- 播放时显示暂停图标 -->
                                    <DataTrigger Binding="{Binding MaximizeButtonIcon }" Value="True">
                                        <Setter Property="Kind" Value="Restore"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </controls:CustomIcon.Style>
                    </controls:CustomIcon>
                </ui:Button>
                <!-- 关闭按钮 -->
                <ui:Button Margin="5,0,5,0" Command="{Binding CloseWindowCommand}"  CornerRadius="8"
                    ToolTip="最小化到系统托盘（按住Shift直接关闭）"
        Cursor="Hand">
                    <ui:Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Height" Value="35" />
                            <Setter Property="Width" Value="40"/>
                            <Setter Property="FontSize" Value="12"/>
                         
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border" CornerRadius="8" >
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="Red"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ui:Button.Style>
                    <controls:CustomIcon Kind="Close" IconSize="12" />
                </ui:Button>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>